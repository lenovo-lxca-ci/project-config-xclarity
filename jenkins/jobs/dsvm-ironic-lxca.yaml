- job-template:
    name: 'lenovo-tempest-dsvm-ironic-lxca'
    node: '{node}'

    wrappers:
      - timeout:
          timeout: 125
          fail: true
      - timestamps

    builders:
      - link-logs
      - net-info
      - devstack-checkout
      - shell: |
          #!/bin/bash -xe
          echo "We are inside lxca gate"
          # install packages
          # sudo pip install python-xclarityclient

          # clone projects
          sudo mkdir -p /opt/stack
          sudo chown ironic.ironic /opt/stack
          sudo chmod 0777 /opt/stack
          cd /opt/stack
          git clone https://github.com/openstack-dev/devstack.git
          git clone https://github.com/openstack/ironic.git
          git clone https://github.com/openstack/ironic-tempest-plugin.git

          # update ironic
          #cd /opt/stack/ironic
          #git config --global user.name "lenovo-lxca-ci"
          #git config --global user.email "lenovo.lxca.ci@gmail.com"
          #git fetch https://git.openstack.org/openstack/ironic refs/changes/1/123456/7 && git cherry-pick FETCH_HEAD

          # run stack
          cd /opt/stack/devstack/
          cp /tmp/local.conf.sample local.conf
          ./stack.sh

    publishers:
      - devstack-logs
      - console-log
